# 画面設計書

## 画面ID: RST001  
## 画面名: 対局結果管理画面

---

### 1. 画面概要

- 登録済みの対局結果を一覧表示し、登録、更新、削除操作を行う。  
- 非同期通信は使用せず、すべてHTMLフォームとSSRで構成。  
- 管理者のみアクセス可能。

---

### 2. 画面レイアウト

- 上部メニューバー：画面タイトル「対局管理」、Dashboardボタン  
- 対局結果一覧テーブル：試合日時、勝者、敗者、操作列（更新ボタン、削除ボタン）  

---

### 3. 入力項目

| 項目名     | 型     | 必須 | バリデーション         | 備考                     |
|------------|--------|------|------------------------|--------------------------|
| 勝者のID   | UUID   | ○    | 存在するプレイヤーID   | セレクトボックスで選択   |
| 敗者のID   | UUID   | ○    | 存在するプレイヤーID   | セレクトボックスで選択   |

> ※ 本画面では直接入力フォームは存在しないが、別画面またはモーダルでの登録・更新フォームにて使用されることを想定。

---

### 4. 出力項目（表示内容）

| 項目名     | 型     | 備考                         |
|------------|--------|------------------------------|
| 勝者       | 文字列 | 勝者の名前                   |
| レート     | 文字列 | 勝者のレート                 |
| 敗者       | 文字列 | 敗者の名前                   |
| レート     | 文字列 | 敗者のレート                 |
| 操作       | ボタン | 削除（自己削除は禁止）       |

---

### 5. ボタン・操作

| ボタン名     | アクション       | 遷移先／処理内容               |
|--------------|------------------|--------------------------------|
| 削除         | 削除処理         | `/results/delete` にPOST送信   |
| Dashboard    | ダッシュボードへ | `/dashboard` に遷移            |

---

### 6. 遷移仕様

| 遷移元画面     | 条件               | 遷移先画面         |
|----------------|--------------------|--------------------|
| ログイン画面   | 認証成功           | 対局結果管理画面   |
| 対局結果管理画面 | 削除フォーム送信   | 同画面を再描画     |
| 未ログイン時   | セッション未検出時 | `/login` にリダイレクト |

---

### 7. バリデーション仕様

- クライアント側チェック（HTML属性）  
  - `required` による必須入力（削除対象ID）  
- サーバー側チェック  
  - 試合IDの存在確認  
  - 自己削除の禁止（セッションIDと比較）  
  - 勝者・敗者IDの存在確認と重複禁止（同一ID不可）

---

### 8. エラーメッセージ一覧

| エラーコード | メッセージ内容                     | 表示タイミング                     |
|--------------|------------------------------------|------------------------------------|
| E201         | 試合IDが見つかりません             | 削除フォーム送信時、ID不正時       |
| E202         | 自分自身の試合は削除できません     | 削除フォーム送信時、ID一致時       |
| E203         | 勝者と敗者は同一にできません       | 登録・更新フォーム送信時           |

---

### 9. 備考

- `getServerSession()` によるSSRセッション制御  
- `session.user.id` を型拡張して安全に参照  
- 非同期通信は使用せず、すべてHTMLフォームとPOSTルートで構成  
- CSSフレームワークは未使用（Tailwind等は導入されていない）  
- `playedAt` は `Date` 型として扱い、ローカライズ表示される