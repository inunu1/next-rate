# 画面設計書

## 画面ID: PLY001  
## 画面名: 対局者管理画面

---

### 1. 画面概要

- 登録済みの対局者ユーザーを一覧表示し、新規登録および更新操作を行う。  
- 非同期通信を使用せず、すべてHTMLフォームとSSRで構成。

---

### 2. 画面レイアウト

- 上部にメニューバー（画面タイトル、Dashboardボタン）  
- 登録フォームバー（プレイヤー名、初期レーティング、登録ボタン）  
- 対局者一覧テーブル（プレイヤー名、現在レート、初期レート、操作列）  
- 操作列には編集ボタン（自身以外のユーザーのみ表示）

---

### 3. 入力項目

| 項目名        | 型       | 必須   | バリデーション           | 備考               |
|---------------|----------|-------- |--------------------------|--------------------|
| ユーザー名    | text     | ○      | 最大50文字               | 重複不可           |
| 初期レート  | 整数     | ○      | 4桁の整数 | 必須           |
---

### 4. 出力項目（表示内容）

| 項目名     | 型     | 備考                     |
|------------|--------|--------------------------|
| プレイヤー名 | 文字列 | 登録済みユーザー名       |
| レート       | 文字列 | レート |
| 初期レート       | 文字列 | レート |
| 操作       | ボタン | 編集 |

---

### 5. ボタン・操作

| ボタン名     | アクション       | 遷移先／処理内容               |
|--------------|------------------|--------------------------------|
| 対局者登録   | 登録処理         | `/players/register` にPOST送信 |
| 編集         | 更新処理         | `/players/update` にPOST送信   |
| Dashboard    | ダッシュボードへ | `/dashboard` に遷移            |

---

### 6. 遷移仕様

| 遷移元画面     | 条件               | 遷移先画面     |
|----------------|--------------------|----------------|
| ログイン画面   | 認証成功           | 対局者管理画面 |
| 対局者管理画面 | 削除ボタン押下     | 同画面を再描画 |
| 対局者管理画面 | 登録フォーム送信   | 同画面を再描画 |
| 未ログイン時   | セッション未検出時 | `/login` にリダイレクト |

---

### 7. バリデーション仕様

- クライアント側チェック（HTML属性で対応）  
  - `required` による必須入力  
  - `maxlength` による文字数制限  
- サーバー側チェック  
  - ユーザー名の重複チェック  
  - パスワードのハッシュ化  
  - 自己削除の禁止（セッションIDと比較）

---

### 8. エラーメッセージ一覧

| エラーコード | メッセージ内容                     | 表示タイミング                     |
|--------------|------------------------------------|------------------------------------|
| E101         | ユーザー名を入力してください       | 登録フォーム送信時、未入力時       |
| E102         | パスワードを入力してください       | 登録フォーム送信時、未入力時       |
| E103         | このユーザー名は既に登録済みです   | サーバー側で重複検出時             |
| E104         | 自分自身は削除できません           | 削除フォーム送信時、ID一致時       |

---

### 9. 備考

- この画面は管理者のみアクセス可能  
- `useSession()` は使用せず、`getServerSession()` によるSSRセッション制御  
- 非同期通信は一切使用せず、すべてHTMLフォームとPOSTルートで構成  
- セッション情報は `session.user.id` を型拡張して安全に参照