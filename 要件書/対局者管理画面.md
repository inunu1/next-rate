# 画面設計書

## 画面ID: PLY001  
## 画面名: 対局者管理画面

---

### 1. 画面概要

- 登録済みの対局者を一覧表示し、新規登録および編集操作を行う。  
- 非同期通信は使用せず、すべてHTMLフォームとSSRで構成。  
- 管理者のみアクセス可能。

---

### 2. 画面レイアウト

- 上部メニューバー：画面タイトル「対局者管理」、Dashboardボタン  
- 登録フォームバー：プレイヤー名、初期レート、登録ボタン（POST送信）  
- 対局者一覧テーブル：プレイヤー名、現在レート、初期レート、操作列（編集ボタン）  
- 編集ボタンは自身以外のプレイヤーにのみ表示

---

### 3. 入力項目

| 項目名       | 型     | 必須 | バリデーション         | 備考                             |
|--------------|--------|------|------------------------|----------------------------------|
| プレイヤー名 | text   | ○    | 最大50文字、重複不可   | HTML `required` + `maxlength`   |
| 初期レート   | number | ○    | 4桁整数                | HTML `required` + `pattern="\d{4}"` |

---

### 4. 出力項目（表示内容）

| 項目名       | 型     | 備考                         |
|--------------|--------|------------------------------|
| プレイヤー名 | 文字列 | 登録済みプレイヤー名         |
| 現在レート   | 数値   | 対局結果に応じて変動         |
| 初期レート   | 数値   | 登録時に指定されたレート     |
| 操作         | ボタン | 編集（自身以外のプレイヤー） |

---

### 5. ボタン・操作

| ボタン名     | アクション       | 遷移先／処理内容               |
|--------------|------------------|--------------------------------|
| 対局者登録   | 登録処理         | `/players/register` にPOST送信 |
| 編集         | 更新処理         | `/players/update` にPOST送信   |
| Dashboard    | ダッシュボードへ | `/dashboard` に遷移            |

---

### 6. 遷移仕様

| 遷移元画面     | 条件               | 遷移先画面     |
|----------------|--------------------|----------------|
| ログイン画面   | 認証成功           | 対局者管理画面 |
| 対局者管理画面 | 登録フォーム送信   | 同画面を再描画 |
| 対局者管理画面 | 編集フォーム送信   | 同画面を再描画 |
| 未ログイン時   | セッション未検出時 | `/login` にリダイレクト |

---

### 7. バリデーション仕様

- クライアント側チェック（HTML属性）  
  - `required` による必須入力  
  - `maxlength` による文字数制限  
  - `pattern` による整数チェック  
- サーバー側チェック  
  - プレイヤー名の重複チェック  
  - 自己編集の制限（セッションIDと比較）

---

### 8. エラーメッセージ一覧

| エラーコード | メッセージ内容                     | 表示タイミング                     |
|--------------|------------------------------------|------------------------------------|
| E101         | プレイヤー名を入力してください     | 登録フォーム送信時、未入力時       |
| E102         | 初期レートを入力してください       | 登録フォーム送信時、未入力時       |
| E103         | このプレイヤー名は既に登録済みです | サーバー側で重複検出時             |
| E104         | 自分自身は編集できません           | 編集フォーム送信時、ID一致時       |

---

### 9. 備考

- `getServerSession()` によるSSRセッション制御  
- `session.user.id` を型拡張して安全に参照  
- 非同期通信は使用せず、すべてHTMLフォームとPOSTルートで構成  